import os
from flask import Flask, render_template, request, make_response

app = Flask(__name__)

@app.route('/', methods=['GET', 'POST', 'HEAD'])
def index():
    if request.method == 'HEAD':
        return make_response('', 200)

    result_data = None
    
    if request.method == 'POST':
        try:
            product_name = request.form.get('keyword', '').strip()
            selling_price = request.form.get('selling_price', '0')
            
            if product_name and selling_price:
                price_val = float(selling_price)
                w_price = round(price_val * 0.55, 2)
                profit_val = round(price_val - w_price, 2)
                
                result_data = {
                    "trend_score": 88,
                    "wholesale_price": w_price,
                    "profit": profit_val,
                    "competition": "Medium"
                }
        except ValueError:
            result_data = {"error": "Price sahi nahi hai. Kripya number dalein."}
        except Exception as e:
            result_data = {"error": f"Kuch galti hui: {str(e)}"}

    return render_template('index.html', result=result_data)

if __name__ == '__main__':
    port = int(os.environ.get('PORT', 5000))
    app.run(host='0.0.0.0', port=port)
